---
- name: Creates directory
  become: true
  file:
    path: /home/ubuntu/web
    state: directory
- name: Extract the artifact
  become: true
  unarchive:
    src: '~/project/artifact.tar.gz'
    dest: '/home/ubuntu/web'
- name: Stop app.
  become: true
  shell: |
    cd /home/ubuntu/web
    pm2 stop default
  ignore_errors: yes
- name: Npm install
  become: true
  shell: |
    cd /home/ubuntu/web
    npm install
- name: Start the web app
  become: true
  shell: |
    cd /home/ubuntu/web
    pm2 start npm -- start
